#!/bin/bash
# ============================================================
#  LyricFlow â€” One-Command Pipeline Launcher (NeMo Edition)
#  Usage: ./start
#
#  1. Drop MP3 files into input_songs/
#  2. Drop matching .txt files into ground_truth_lyrics/
#  3. Run: ./start
# ============================================================

set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
cd "$SCRIPT_DIR"

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘   ğŸµ LyricFlow Pipeline (NeMo Alignment) Starting  â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Use python3.11 (NeMo is installed here)
PYTHON=python3.11

# Verify python3.11 exists
if ! command -v $PYTHON &> /dev/null; then
    echo "âŒ python3.11 not found. Please install it:"
    echo "   brew install python@3.11"
    exit 1
fi

# Check input folder
if [ ! -d "input_songs" ]; then
    mkdir -p input_songs
    echo "ğŸ“ Created input_songs/ folder. Drop your MP3 files there!"
    exit 0
fi

MP3_COUNT=$(find input_songs -name "*.mp3" | wc -l | tr -d ' ')
if [ "$MP3_COUNT" = "0" ]; then
    echo "âŒ No MP3 files found in input_songs/"
    echo "   Drop your MP3 files there and run ./start again."
    exit 1
fi

echo "ğŸµ Found $MP3_COUNT MP3 file(s) to process"
echo ""

# Ensure ground truth lyrics folder exists
mkdir -p ground_truth_lyrics

# Run the batch processor with python3.11 (pass all args through)
$PYTHON batch_processor.py "$@"

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘         âœ… All done! Check output_song/ folder      â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
